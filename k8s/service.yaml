apiVersion: v1
kind: Service
metadata:
  name: cats-dogs-classifier-svc
  namespace: mlops
  labels:
    app: cats-dogs-classifier
spec:
  type: LoadBalancer          # Use NodePort for minikube/kind
  selector:
    app: cats-dogs-classifier
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 8000

---
# ── Namespace ──────────────────────────────────────────────────────────────────
apiVersion: v1
kind: Namespace
metadata:
  name: mlops

---
# ── PersistentVolumeClaim for model artifacts ─────────────────────────────────
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: model-pvc
  namespace: mlops
spec:
  accessModes:
    - ReadOnlyMany
  resources:
    requests:
      storage: 500Mi

---
# ── HorizontalPodAutoscaler ───────────────────────────────────────────────────
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: cats-dogs-hpa
  namespace: mlops
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: cats-dogs-classifier
  minReplicas: 2
  maxReplicas: 6
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
